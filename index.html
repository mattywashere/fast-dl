<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>FastDL</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
::-webkit-scrollbar{width:8px}
::-webkit-scrollbar-thumb{background:#9ca3af}
::-webkit-scrollbar-track{background:#111827}
a{color:inherit}
</style>
</head>
<body class="bg-black text-gray-300 font-mono antialiased">
<div id="app" class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
<a id="back" href="javascript:void(0)" onclick="nav(null)" class="hidden text-gray-400 text-3xl mb-4 pl-3 cursor-pointer">&lt;</a>
<main><div id="list" class="space-y-0 text-gray-300"></div></main>
</div>
<script>
const USER='mattywashere',REPO='fast-dl',BRANCH='main',CATS=['deathrun','murder','prophunt','smash'];
let cur=null,list=document.getElementById('list'),back=document.getElementById('back');

const fmt=b=>{
  if(!b)return'0 bytes';
  const k=1024,s=['bytes','kb','mb','gb','tb'],i=Math.floor(Math.log(b)/Math.log(k));
  return (b/Math.pow(k,i)).toFixed(2)+' '+s[i];
};

const entry=(n,f,s=null)=>{
  const e=document.createElement('a');
  e.className='flex flex-col sm:flex-row justify-between items-start sm:items-center py-3 px-3 cursor-pointer mb-0.5';
  if(f){
    e.href='/'+n;
    e.onclick=x=>{x.preventDefault();nav(n)};
    e.innerHTML=`<span class="text-gray-300 truncate"><span class="text-white mr-2">${n}/</span></span>`;
  }else{
    const url=`https://raw.githubusercontent.com/${USER}/${REPO}/${BRANCH}/${cur}/${encodeURIComponent(n)}`;
    e.href=url;e.target='_blank';
    e.innerHTML=`<span class="text-gray-300 truncate"><span class="text-white mr-2">/${cur}/</span>${n}</span><span class="text-sm text-gray-400 sm:ml-4 mt-1 sm:mt-0 whitespace-nowrap">${fmt(s)}</span>`;
  }
  return e;
};

const cats=()=>{
  list.className='space-y-0 text-gray-300';list.innerHTML='';
  CATS.forEach(c=>list.appendChild(entry(c,1)));
  back.classList.add('hidden');
};

const nav=p=>{
  cur=p;
  if(!p){
    history.pushState(null,'',location.origin+'/'+REPO+'/');
    cats();return;
  }
  history.pushState({p},'',`/${REPO}/${p}`);
  load(p);
};

const load=async p=>{
  list.innerHTML='<p class="text-gray-500 p-3">fetching directory data...</p>';
  back.classList.remove('hidden');
  try{
    const r=await fetch(`https://api.github.com/repos/${USER}/${REPO}/contents/${p}?ref=${BRANCH}&${Date.now()}`);
    list.className='space-y-0 text-gray-300';
    if(!r.ok){list.innerHTML=`<p class="text-red-400 p-3">error loading *${p}*</p>`;return;}
    const d=await r.json(),f=d.filter(i=>i.type==='file').sort((a,b)=>a.name.localeCompare(b.name));
    list.innerHTML=f.length?'' : `<p class="text-gray-400 p-3">no files found in **/${p}/**</p>`;
    f.forEach(x=>list.appendChild(entry(x.name,0,x.size)));
  }catch{list.innerHTML='<p class="text-red-400 p-3">network error</p>'}
};

onpopstate=()=>{
  const s=location.pathname.split('/').filter(x=>x),
  i=s.indexOf(REPO);
  let p=null;
  if(i!=-1&&s[i+1]&&CATS.includes(s[i+1]))p=s[i+1];
  p?(cur=p,load(p)):(cur=null,cats());
};

const init=()=>{
  const s=location.pathname.split('/').filter(x=>x),i=s.indexOf(REPO);
  const p=i!=-1&&s[i+1]&&CATS.includes(s[i+1])?s[i+1]:null;
  p?(cur=p,load(p)):cats();
};
init();
</script>
</body>
</html>