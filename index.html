<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <!-- load tailwind css for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* custom scrollbar styles for dark theme */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-thumb {
            background: #9ca3af; /* gray-400 */
        }
        ::-webkit-scrollbar-track {
            background: #111827; /* very dark gray */
        }
        /* loading indicator animation: cycles through '.', '. .', and '. . .' */
        .loading-dots:after {
            overflow: hidden;
            display: inline-block;
            vertical-align: bottom;
            -webkit-animation: loading-dots 1s infinite steps(1, start);
            animation: loading-dots 1s infinite steps(1, start);
            content: "";
        }
        
        @keyframes loading-dots {
            0% { content: ""; }
            25% { content: "."; }
            50% { content: ". ."; }
            75% { content: ". . ."; }
            100% { content: ""; }
        }
        @-webkit-keyframes loading-dots {
            0% { content: ""; }
            25% { content: "."; }
            50% { content: ". ."; }
            75% { content: ". . ."; }
            100% { content: ""; }
        }

        /* ensure links inherit text color */
        a {
            color: inherit;
        }
    </style>
</head>
<!-- set body to black background and monospace font -->
<body class="bg-black text-gray-300 antialiased font-mono">

    <div id="app" class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8 **h-screen**">
        
        <!-- back button: hidden when viewing categories, shown when viewing files -->
        <a id="back-button" 
           href="javascript:void(0)" 
           onclick="fetchContent(null)"
           class="hidden text-gray-400 text-3xl mb-4 pl-3 cursor-pointer">
            &lt;
        </a>

        <!-- dynamic content area: where categories and files are listed -->
        <main>
            <div id="file-list-container" class="space-y-0">
            </div>
        </main>

    </div>

    <!-- javascript for dynamic github file fetching -->
    <script>
        // === github repository configuration ===
        const GITHUB_USERNAME = 'mattywashere'; 
        const REPO_NAME = 'fast-dl'; 
        const REPO_BRANCH = 'main'; 
        // =======================================

        // the defined categories (folders) at the root level
        const CATEGORIES = ['deathrun', 'murder', 'prophunt', 'smash'];
        
        let currentPath = null; 

        const listContainer = document.getElementById('file-list-container');
        const backButton = document.getElementById('back-button'); 
        
        // resets the file list container to its normal flow
        function resetListContainerClasses() {
             listContainer.className = 'space-y-0';
        }

        // displays the loading state in lowercase and centers it
        function showLoading() {
            // we use flex and justify-center here, relying on the #app div having h-screen
            listContainer.className = 'flex items-center justify-center h-full space-y-0'; 
            listContainer.innerHTML = `<p class="text-gray-400">loading <span class="loading-dots"></span></p>`;
        }

        // calculates safe log (used for size formatting)
        const log = (x) => Math.log(x) / Math.LN10;

        // converts file size in bytes to human-readable format (e.g., "1.2 mb")
        function formatBytes(bytes, decimals = 2) {
            if (bytes === 0) return '0 bytes';
            const k = 1024;
            const dm = decimals < 0 ? 0 : decimals;
            const sizes = ['bytes', 'kb', 'mb', 'gb', 'tb'];
            const i = Math.floor(log(bytes) / log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
        }
        
        // renders a single entry (category or file)
        function renderEntry(name, isFolder, size = null) {
            const entryElement = document.createElement('a');
            
            // static style for the clickable row (no hover effects)
            entryElement.className = 'flex flex-col sm:flex-row justify-between items-start sm:items-center py-3 px-3 cursor-pointer mb-0.5';

            if (isFolder) {
                // category entry
                entryElement.href = "javascript:void(0)";
                entryElement.onclick = () => fetchContent(name);

                entryElement.innerHTML = `
                    <span class="text-gray-300 truncate">
                        <span class="text-white mr-2">${name}/</span>
                    </span>
                `;
            } else {
                // file entry
                const downloadUrl = \`https://raw.githubusercontent.com/\${GITHUB_USERNAME}/\${REPO_NAME}/\${REPO_BRANCH}/\${currentPath}/\${encodeURIComponent(name)}\`;
                entryElement.href = downloadUrl; 
                entryElement.target = "_blank";

                entryElement.innerHTML = \`
                    <span class="text-gray-300 truncate">
                        <span class="text-white mr-2">/\${currentPath}/</span>\${name}
                    </span>
                    <span class="text-sm text-gray-400 sm:ml-4 mt-1 sm:mt-0 whitespace-nowrap">
                        \${formatBytes(size)}
                    </span>
                \`;
            }
            return entryElement;
        }

        // renders the initial list of categories
        function renderCategoryList() {
            resetListContainerClasses();
            listContainer.innerHTML = '';
            
            CATEGORIES.forEach(category => {
                const entry = renderEntry(category, true);
                listContainer.appendChild(entry);
            });
        }
        
        // fetches and displays content from the github repository
        async function fetchContent(path = null) {
            currentPath = path;
            showLoading();

            // control back button visibility
            if (path === null) {
                backButton.classList.add('hidden');
                renderCategoryList();
                return;
            } else {
                backButton.classList.remove('hidden');
            }

            const apiURL = \`https://api.github.com/repos/\${GITHUB_USERNAME}/\${REPO_NAME}/contents/\${path}?ref=\${REPO_BRANCH}\`;

            listContainer.innerHTML = '';

            try {
                const response = await fetch(apiURL);
                
                resetListContainerClasses();

                if (!response.ok) {
                    // error if the folder doesn't exist
                    listContainer.innerHTML = \`<p class="text-red-400 p-3">error: could not load the directory for *\${path}*. check that the folder exists in your github repo and is spelled correctly.</p>\`;
                    return;
                }

                const data = await response.json();
                
                // only show files, sorted alphabetically
                const files = data
                    .filter(item => item.type === 'file')
                    .sort((a, b) => a.name.localeCompare(b.name));
                
                if (files.length === 0) {
                    // message if the directory is empty
                    listContainer.innerHTML += \`<p class="text-gray-400 p-3">no files found in the **/\${path}/** directory.</p>\`;
                } else {
                    files.forEach(file => {
                        const fileEntry = renderEntry(file.name, false, file.size);
                        listContainer.appendChild(fileEntry);
                    });
                }

            } catch (error) {
                console.error("failed to fetch map files:", error);
                // general network error message
                listContainer.innerHTML += '<p class="text-red-400 p-3">a network or api error occurred while trying to load files.</p>';
            }
        }

        // start the app
        fetchContent(null);
    </script>
</body>
</html>
