<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <!-- load tailwind css for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* custom scrollbar styles for dark theme */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-thumb {
            background: #9ca3af; /* gray-400 */
        }
        ::-webkit-scrollbar-track {
            background: #111827; /* very dark gray */
        }

        /* ensure links inherit text color */
        a {
            color: inherit;
        }
    </style>
</head>
<!-- set body to black background and monospace font -->
<body class="bg-black text-gray-300 antialiased font-mono">

    <div id="app" class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
        
        <!-- back button: hidden when viewing categories, shown when viewing files -->
        <a id="back-button" 
           href="javascript:void(0)" 
           onclick="fetchContent(null)"
           class="hidden text-gray-400 text-3xl mb-4 pl-3 cursor-pointer">
            &lt;
        </a>

        <!-- dynamic content area: where categories and files are listed -->
        <main>
            <!-- ADDED text-gray-300 CLASS HERE TO GUARANTEE VISIBILITY -->
            <div id="file-list-container" class="space-y-0 text-gray-300">
                <!-- initial categories or file list will be injected here -->
            </div>
        </main>

    </div>

    <!-- javascript for dynamic github file fetching -->
    <script>
        // === github repository configuration ===
        const GITHUB_USERNAME = 'mattywashere'; 
        const REPO_NAME = 'fast-dl'; 
        const REPO_BRANCH = 'main'; 
        // =======================================

        // the defined categories (folders) at the root level
        const CATEGORIES = ['deathrun', 'murder', 'prophunt', 'smash'];
        
        let currentPath = null; 

        const listContainer = document.getElementById('file-list-container');
        const backButton = document.getElementById('back-button'); 
        
        // resets the file list container to its normal flow
        function resetListContainerClasses() {
             // ensure base classes remain, especially the new guaranteed text color
             listContainer.className = 'space-y-0 text-gray-300'; 
        }

        // calculates safe log (used for size formatting)
        const log = (x) => Math.log(x) / Math.LN10;

        // converts file size in bytes to human-readable format (e.g., "1.2 mb")
        function formatBytes(bytes, decimals = 2) {
            if (bytes === 0) return '0 bytes';
            const k = 1024;
            const dm = decimals < 0 ? 0 : decimals;
            const sizes = ['bytes', 'kb', 'mb', 'gb', 'tb'];
            const i = Math.floor(log(bytes) / log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
        }
        
        // renders a single entry (category or file)
        function renderEntry(name, isFolder, size = null) {
            const entryElement = document.createElement('a');
            
            // static style for the clickable row (no hover effects)
            entryElement.className = 'flex flex-col sm:flex-row justify-between items-start sm:items-center py-3 px-3 cursor-pointer mb-0.5';

            if (isFolder) {
                // category entry
                entryElement.href = "javascript:void(0)";
                entryElement.onclick = () => fetchContent(name);

                entryElement.innerHTML = '<span class="text-gray-300 truncate">'
                    + '<span class="text-white mr-2">' + name + '/</span>'
                    + '</span>';
            } else {
                // file entry
                const downloadUrl = 'https://raw.githubusercontent.com/' + GITHUB_USERNAME + '/' + REPO_NAME + '/' + REPO_BRANCH + '/' + currentPath + '/' + encodeURIComponent(name);
                entryElement.href = downloadUrl; 
                entryElement.target = "_blank";

                entryElement.innerHTML = '<span class="text-gray-300 truncate">'
                    + '<span class="text-white mr-2">/' + currentPath + '/</span>' + name
                    + '</span>'
                    + '<span class="text-sm text-gray-400 sm:ml-4 mt-1 sm:mt-0 whitespace-nowrap">'
                    + formatBytes(size)
                    + '</span>';
            }
            return entryElement;
        }

        // renders the initial list of categories (static content)
        function renderCategoryList() {
            resetListContainerClasses();
            listContainer.innerHTML = '';
            
            CATEGORIES.forEach(category => {
                const entry = renderEntry(category, true);
                listContainer.appendChild(entry);
            });
            // hide back button at root
            backButton.classList.add('hidden');
        }
        
        // fetches and displays content from the github repository (dynamic content)
        async function fetchContent(path = null) {
            currentPath = path;

            // if path is null, we are returning to the root, so skip API call
            if (path === null) {
                renderCategoryList();
                return;
            }

            // show a quick message before fetching (since we removed the animation)
            listContainer.innerHTML = '<p class="text-gray-500 p-3">fetching directory data...</p>';
            backButton.classList.remove('hidden');

            // generate a cache-busting timestamp
            const cacheBuster = Date.now();
            
            // append the cache buster to the API URL
            const apiURL = 'https://api.github.com/repos/' + GITHUB_USERNAME + '/' + REPO_NAME + '/contents/' + path + '?ref=' + REPO_BRANCH + '&' + cacheBuster;

            try {
                const response = await fetch(apiURL);
                
                resetListContainerClasses();

                if (!response.ok) {
                    // error if the folder doesn't exist or API fails
                    const errorText = 'error: failed to load *' + path + '*. this may be due to the folder not existing or github api rate limits.';
                    listContainer.innerHTML = '<p class="text-red-400 p-3">' + errorText + '</p>';
                    return;
                }

                const data = await response.json();
                
                // only show files, sorted alphabetically
                const files = data
                    .filter(item => item.type === 'file')
                    .sort((a, b) => a.name.localeCompare(b.name));
                
                if (files.length === 0) {
                    // message if the directory is empty
                    listContainer.innerHTML = '<p class="text-gray-400 p-3">no files found in the **/' + path + '/** directory.</p>';
                } else {
                    listContainer.innerHTML = ''; // clear message
                    files.forEach(file => {
                        const fileEntry = renderEntry(file.name, false, file.size);
                        listContainer.appendChild(fileEntry);
                    });
                }

            } catch (error) {
                console.error("failed to fetch map files:", error);
                // general network error message
                listContainer.innerHTML = '<p class="text-red-400 p-3">a network error occurred (check your connection).</p>';
            }
        }

        // start the app by rendering the static category list
        renderCategoryList();
    </script>
</body>
</html>
